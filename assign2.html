<!doctype html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1, viewport-fit=cover' />
    <title>CS253 - Web Security</title>
    <meta name='description' content='Principles of web security. The fundamentals and state-of-the-art in web security. Attacks and countermeasures. Topics include: the browser security model, web app vulnerabilities, injection, denial-of-service, TLS attacks, privacy, fingerprinting, same-origin policy, cross site scripting, authentication, JavaScript security, emerging threats, defense-in-depth, and techniques for writing secure code. Course projects include writing security exploits, defending insecure web apps, and implementing emerging web standards.' />
    <meta name='theme-color' content='#B1040E' />
    <meta name='color-scheme' value='light dark' />
    <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700&display=swap' rel='stylesheet' />
    <link rel='stylesheet' href='normalize.css' />
    <link rel='stylesheet' href='style.css' />
  </head>
  <body>
    <div class='content'>
      <a href='https://cs253.stanford.edu' class='logo'>
        <img src='stanford.svg' alt='Stanford' />
        <h1>CS 253 Web Security</h1>
      </a>

      <h2>Assignment 2 â€“ Oh What a Tangled Web We Weave ðŸ•¸</h2>
<ul>
<li><strong>Points:</strong> 63</li>
<li><strong>Due:</strong> Thursday, November 7 at 11:59pm</li>
</ul>
<p>Welcome to Assignment 2 for <a href="https://cs253.stanford.edu" target="_blank" rel="nofollow noopener noreferrer">CS 253: Web Security</a>. âœ¨</p>
<h3>Short Answer Questions</h3>
<p>Your answers should be concise. Unless otherwise specified, keep answers to 100 words or fewer.</p>
<h3>Code Injection</h3>
<ol>
<li>
<p>You and a friend built a site that accepts and displays user-generated content. You recently read <a href="https://xkcd.com/327/" target="_blank" rel="nofollow noopener noreferrer">the XKCD comic about code injection</a> which made you realize that you're not sanitizing user-submitted data anywhere in your web app. You realize that you're almost certainly vulnerable to Cross site scripting (XSS) and SQL injection attacks â€“ yikes!</p>
<p>Rereading the comic, you notice it ends with the phrase "I hope you've learned to sanitize your database inputs". Your friend suggests solving the issue by escaping all user-submitted data <em>before</em> inserting it into the database. Your friend argues that by sanitizing the <em>inputs</em> to the database as the comic suggests,  the data can then be extracted from the database and safely used in HTML and SQL without further escaping.</p>
<p>Is this a valid argument? (Yes/No) Why or why not?</p>
</li>
<li>
<p>You and a friend decide to build an internal dashboard that will show real-time HTTP requests that are being sent by visitors to your site. The dashboard displays information about each HTTP request received by the web server, including the client's IP address, HTTP method, URL, query parameters, referrer URL, and user agent name.</p>
<p>Incidentally, this is the exact set of information that most popular web servers like Nginx or Apache print into the server log files. Here is what one line from such a log file looks like:</p>
<pre><code class="hljs language-yml"><span class="hljs-number">12.34</span><span class="hljs-number">.56</span><span class="hljs-number">.78</span> <span class="hljs-bullet">-</span> <span class="hljs-bullet">-</span> [<span class="hljs-number">17</span><span class="hljs-string">/Oct/2019:05:01:59</span> <span class="hljs-string">+0000</span>] <span class="hljs-string">"GET /api/midi/search?q=hi&#x26;page=0 HTTP/1.0"</span> <span class="hljs-number">200</span> <span class="hljs-number">178</span> <span class="hljs-string">"https://example.com/search?q=h"</span> <span class="hljs-string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36"</span></code></pre>
<p>The internal dashboard will only be used by you and your friend and will not be exposed to the broader internet since the logs reveal information about your site visitors. Your friend argues that there is no need to worry about XSS vulnerabilites in an internal-only dashboard since neither of you would create an XSS attack to use against the other. Given that, they see no way that an XSS attack could occur.</p>
<p>Is this a valid argument? (Yes/No) Why or why not?</p>
</li>
<li>
<p>Name a real-world case where adherence to the Robustness principle (a.k.a. Postel's law) caused a system to have worse security. Explain how the Robustness principle led to the system having worse security properties.</p>
</li>
</ol>
<h3>Same Origin Policy</h3>
<ol start="4">
<li>
<p>Name three ways that the Same Origin Policy protects a website.</p>
</li>
<li>
<p>Can JavaScript code running on <strong>attacker.com</strong> cause a GET request to be sent to <strong>victim.com</strong>? (Yes/No)</p>
</li>
<li>
<p>Can JavaScript code running on <strong>attacker.com</strong> use the <code>fetch()</code> API to send a GET request to <strong>victim.com</strong> and read the HTTP response body? (Yes/No)</p>
<p>Assume no CORS headers are present on the response.</p>
</li>
<li>
<p>Can JavaScript code running on <strong>attacker.com</strong> submit a form via a POST request to <strong>victim.com</strong>? (Yes/No)</p>
</li>
<li>
<p>A fascinating Same origin policy "bypass" was described in <a href="https://www.usenix.org/conference/usenixsecurity09/technical-sessions/presentation/cross-origin-javascript-capability-leaks" target="_blank" rel="nofollow noopener noreferrer">"Cross-Origin JavaScript Capability Leaks: Detection, Exploitation, and Defense"</a>, a talk at USENIX '09 (one of the top security conferences). How could an attacker use this browser implementation bug to bypass the same origin policy? What was the key, underlying reason for the bug? What was the proposed mitigation? Please keep your answer to 200 words or fewer.</p>
</li>
</ol>
<h3>Content Security Policy</h3>
<p>Content Security Policy (CSP) is one of the best ways to protect your site against XSS. A properly written CSP can <strong>completely</strong> protect your site from reflected and stored XSS attacks, even in the presence of a bug that allows the attacker to add their own HTML code to the site.</p>
<p>For all questions, you should assume the user agent is a modern browser that supports the latest Content Security Policy specification, <a href="https://www.w3.org/TR/CSP3/" target="_blank" rel="nofollow noopener noreferrer">CSP Level 3</a>.</p>
<p>You may find these resources useful:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" target="_blank" rel="nofollow noopener noreferrer">MDN: Content Security Policy</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" target="_blank" rel="nofollow noopener noreferrer">MDN: <code>Content-Security-Policy</code> header</a></li>
</ul>
<ol start="9">
<li>
<p>An attacker takes advantage of a vulnerability in your site to inject an XSS payload into the HTML page sent by your server. Fortunately, you set up a CSP in case this happened because you follow a defense-in-depth security approach.</p>
<p>Would the following CSP prevent the XSS attack? (Yes/No)</p>
<p>Why or why not?</p>
<pre><code class="hljs language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>script-src 'self';</code></pre>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span>></span><span class="javascript">alert(<span class="hljs-built_in">document</span>.cookie)</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></code></pre>
</li>
<li>
<p>Would the following CSP prevent the XSS attack? (Yes/No)</p>
<p>Why or why not?</p>
<pre><code class="hljs language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>default-src *; script-src 'self';</code></pre>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span>></span><span class="javascript">alert(<span class="hljs-built_in">document</span>.cookie)</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></code></pre>
</li>
<li>
<p>Would the following CSP prevent the XSS attack? (Yes/No)</p>
<p>Why or why not?</p>
<pre><code class="hljs language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>default-src 'none'; script-src 'self' 'unsafe-eval'; connect-src 'self'; img-src 'self'; style-src 'self';</code></pre>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span>></span><span class="javascript">alert(<span class="hljs-built_in">document</span>.cookie)</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></code></pre>
</li>
<li>
<p>Would the following CSP prevent the XSS attack? (Yes/No)</p>
<p>Why or why not?</p>
<pre><code class="hljs language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>default-src 'none'; script-src 'self' 'unsafe-eval'; connect-src 'self'; img-src 'self'; style-src 'self';</code></pre>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span>></span><span class="javascript"><span class="hljs-built_in">eval</span>(<span class="hljs-string">'alert(document.cookie)'</span>)</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></code></pre>
</li>
<li>
<p>Would the following CSP prevent the XSS attack? (Yes/No)</p>
<p>Why or why not?</p>
<pre><code class="hljs language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>default-src *; script-src 'self'; connect-src *; img-src *; style-src *;</code></pre>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">'https://attacker.com/xss.js'</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></code></pre>
</li>
<li>
<p>Would the following CSP prevent the XSS attack? (Yes/No)</p>
<p>Why or why not?</p>
<pre><code class="hljs language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>default-src 'none'; script-src 'self' https:; connect-src 'none'; img-src 'none'; style-src 'none';</code></pre>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">'https://attacker.com/xss.js'</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></code></pre>
</li>
<li>
<p>Would the following CSP prevent the XSS attack? (Yes/No)</p>
<p>Why or why not?</p>
<pre><code class="hljs language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>script-src 'self' 'nonce-R28gU3RhbmZvcmQh';</code></pre>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span>></span><span class="javascript">alert(<span class="hljs-built_in">document</span>.cookie)</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></code></pre>
</li>
<li>
<p>Would the following CSP prevent the XSS attack? (Yes/No)</p>
<p>Why or why not?</p>
<pre><code class="hljs language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>script-src 'self' 'nonce-R28gU3RhbmZvcmQh';</code></pre>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">'xss'</span>></span><span class="javascript">alert(<span class="hljs-built_in">document</span>.cookie)</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></code></pre>
</li>
<li>
<p>Would the following CSP prevent the XSS attack? (Yes/No)</p>
<p>Why or why not?</p>
<pre><code class="hljs language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>script-src 'self' 'nonce-R28gU3RhbmZvcmQh' 'unsafe-inline';</code></pre>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">'xss'</span>></span><span class="javascript">alert(<span class="hljs-built_in">document</span>.cookie)</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></code></pre>
</li>
<li>
<p>Would the following CSP prevent the XSS attack? (Yes/No)</p>
<p>Why or why not?</p>
<pre><code class="hljs language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>script-src 'self';</code></pre>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">'/api/echo?str=alert(document.cookie)'</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></code></pre>
<p>Where <code>/api/echo</code> is a working API endpoint on the victim webserver that replies back with whatever string it receives in the <code>str</code> query parameter. For example, the URL <code>/api/echo?str=hello</code> returns an HTTP response with a body of <code>hello</code>.</p>
<p>In case it makes a difference, you can assume the API response has a <code>Content-Type</code> header with a value of <code>text/plain</code>.</p>
</li>
<li>
<p>Assume that <strong>victim.com</strong> is protected with the following CSP:</p>
<pre><code class="hljs language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>script-src 'self' 'nonce-&#x3C;nonce-value-here>';</code></pre>
<p>The operator of <strong>attacker.com</strong> attempts to subvert <strong>victim.com</strong>'s CSP by visitng <strong>victim.com</strong> and copying the nonce they observe in the CSP header into their XSS attack payload:</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">'&#x3C;nonce-value-here>'</span>></span><span class="javascript">alert(<span class="hljs-built_in">document</span>.cookie)</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></code></pre>
<p>Would the CSP prevent the XSS attack? (Yes/No) Why or why not?</p>
<p>(Assume that <strong>victim.com</strong> has properly implemented their CSP nonces.)</p>
</li>
<li>
<p>Read the paper <a href="https://ai.google/research/pubs/pub45542" target="_blank" rel="nofollow noopener noreferrer">"CSP Is Dead, Long Live CSP! On the Insecurity of Whitelists and the Future of Content Security Policy"</a>. Explain the problem that <code>'strict-dynamic'</code> keyword solves.</p>
</li>
<li>
<p>Survey Questions</p>
</li>
</ol>
<ul>
<li>Roughly how long did you spend on this assignment? (required)</li>
<li>What was your favorite part of this assignment? (required)</li>
<li>What was your least favorite part of this assignment? (required)</li>
<li>Any other feedback for this assignment? (optional)</li>
</ul>
<h2>Submit</h2>
<h3>Gradescope</h3>
<p>We'll use <a href="https://gradescope.com" target="_blank" rel="nofollow noopener noreferrer">Gradescope</a> for submissions. Enroll with the code <code>97BGZB</code>.</p>
<h3>The moment of truth</h3>
<p>When you're ready to submit your work, upload your assignment in PDF form to Gradescope.</p>
<p>You should submit early and often! There's no downside to repeatedly submitting your assignment.</p>
<h2>Questions?</h2>
<p>Come to office hours or <a href="https://piazza.com/stanford/fall2019/cs253" target="_blank" rel="nofollow noopener noreferrer">post in Piazza</a>.</p>

    </div>
  </body>
</html>
